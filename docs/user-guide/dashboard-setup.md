# Dashboard Setup Guide

This guide helps you set up the Battery Energy Trading dashboard with your specific entity IDs.

## Quick Setup

### Step 1: Find Your Nord Pool Entity

Your Nord Pool entity ID was configured when you set up the Battery Energy Trading integration. To find it:

**Method 1: Via Integration Configuration**
1. Go to **Settings** ‚Üí **Devices & Services**
2. Find **Battery Energy Trading** integration
3. Click **Configure**
4. Your Nord Pool entity is shown in the configuration

**Method 2: Via Developer Tools**
1. Go to **Developer Tools** ‚Üí **States**
2. Search for entities starting with `sensor.battery_energy_trading_`
3. Click on any Battery Energy Trading sensor
4. Look for the `nordpool_entity` attribute (if exposed)

**Method 3: Check Integration Entry**
Your Nord Pool entity is typically one of these patterns:
- `sensor.nordpool_kwh_[country]_[currency]_[area]` (e.g., `sensor.nordpool_kwh_ee_eur_3_10_022`)
- `sensor.nordpool_[region]` (e.g., `sensor.nordpool_tallinn`)

### Step 2: Replace Placeholder in Dashboard

1. Open the dashboard YAML file: `dashboards/battery_energy_trading_dashboard.yaml`
2. Use Find & Replace (Ctrl+F or Cmd+F):
   - **Find:** `YOUR_NORDPOOL_ENTITY`
   - **Replace with:** Your actual Nord Pool entity ID (e.g., `sensor.nordpool_kwh_ee_eur_3_10_022`)
3. Click "Replace All"
4. Save the file

### Step 3: Import Dashboard

1. In Home Assistant, go to **Settings** ‚Üí **Dashboards**
2. Click **+ Add Dashboard**
3. Choose **New dashboard from scratch**
4. Name it "Battery Energy Trading"
5. Click the **‚ãÆ** menu ‚Üí **Edit Dashboard** ‚Üí **‚ãÆ** ‚Üí **Raw configuration editor**
6. Paste the entire contents of your modified `battery_energy_trading_dashboard.yaml`
7. Click **Save**

## Advanced: Automatic Entity Detection

If you want to avoid manual replacement, you can use a template sensor to automatically detect your configured Nord Pool entity.

### Create a Template Sensor

Add this to your `configuration.yaml`:

```yaml
template:
  - sensor:
      - name: "Battery Trading Nord Pool Entity"
        unique_id: battery_trading_nordpool_entity
        state: >
          {% set config_entries = integration_entities('battery_energy_trading') %}
          {% for entity in config_entries %}
            {% if 'discharge_time_slots' in entity %}
              {{ state_attr(entity, 'nordpool_entity') }}
            {% endif %}
          {% endfor %}
```

**Note:** This requires that we expose the `nordpool_entity` in sensor attributes (currently not implemented).

## Troubleshooting

### Dashboard Shows "Entity not available"

**Problem:** The Nord Pool entity ID is incorrect or not found.

**Solution:**
1. Verify the entity ID exists in **Developer Tools** ‚Üí **States**
2. Make sure you replaced **all** instances of `YOUR_NORDPOOL_ENTITY`
3. Check for typos in the entity ID

### ApexCharts Price Chart Not Showing

**Problem:** `custom:apexcharts-card` is not installed.

**Solution:**
1. Go to **HACS** ‚Üí **Frontend**
2. Search for "ApexCharts Card"
3. Click **Download**
4. Restart Home Assistant
5. Hard refresh your browser (Ctrl+Shift+R or Cmd+Shift+R)

**Alternative:** You can remove the price chart section if you don't want to install ApexCharts. All other dashboard cards will work without it.

### Time Slots Show ISO Timestamps Instead of Formatted Times

**Problem:** Jinja2 templates may not render correctly in some dashboard types.

**Solution:**
- Ensure you're using a **standard Home Assistant dashboard** (not custom dashboard types)
- Check that Home Assistant version is 2023.1 or newer (for proper template support)

### Slot Details Show "No discharge slots selected" When They Should Be Active

**Possible Causes:**
1. **Nord Pool Integration Not Providing Data**: Check that `raw_today` attribute exists on your Nord Pool sensor
2. **Price Threshold Too High**: Lower `number.battery_energy_trading_min_forced_sell_price`
3. **Forced Discharge Disabled**: Enable `switch.battery_energy_trading_enable_forced_discharge`
4. **Battery Level Too Low**: Check `number.battery_energy_trading_min_battery_level`

## Entity ID Reference

Replace these placeholders with your actual entity IDs:

| Placeholder | Replace With | Example | Used In Section |
|-------------|--------------|---------|----------------|
| `YOUR_NORDPOOL_ENTITY` | Your Nord Pool price sensor | `sensor.nordpool_kwh_ee_eur_3_10_022` | Price Chart, Current Status |

All other entities follow the pattern `[type].battery_energy_trading_[name]` and don't need replacement (they're auto-generated by the integration).

## Example Entity IDs by Country

### Estonia
```yaml
Nord Pool: sensor.nordpool_kwh_ee_eur_3_10_022
```

### Finland
```yaml
Nord Pool: sensor.nordpool_kwh_fi_eur_3_10_0
```

### Sweden
```yaml
Nord Pool: sensor.nordpool_kwh_se3_sek_3_10_0
Nord Pool: sensor.nordpool_kwh_se4_sek_3_10_0
```

### Norway
```yaml
Nord Pool: sensor.nordpool_kwh_no1_nok_3_10_0
```

### Denmark
```yaml
Nord Pool: sensor.nordpool_kwh_dk1_dkk_3_10_0
```

## Customization Tips

### Change Dashboard Colors

Edit the ApexCharts section colors:
```yaml
series:
  - entity: YOUR_NORDPOOL_ENTITY
    name: Tomorrow
    color: '#03a9f4'  # ‚Üê Change this color
  - entity: YOUR_NORDPOOL_ENTITY
    name: Today
    color: '#ff9800'  # ‚Üê Change this color
```

### Adjust Timeline Emoji

Change the emoji indicators in timeline sections:
```yaml
### üî¥ Discharge Periods  # ‚Üê Change emoji
### üü¢ Charging Periods   # ‚Üê Change emoji
```

### Reorder Dashboard Sections

The dashboard is organized as a list of cards. You can rearrange sections by moving entire `- type: vertical-stack` blocks up or down in the YAML.

### Hide Sections You Don't Need

Comment out or delete entire sections you don't want:
```yaml
# Uncomment to hide Arbitrage Opportunities section:
# - type: vertical-stack
#   cards:
#     - type: markdown
#       content: "## üí∞ Arbitrage Opportunities"
#     ...
```

## Support

If you encounter issues:
1. Check the [Battery Energy Trading GitHub Issues](https://github.com/Tsopic/battery_energy_trading/issues)
2. Review the [main README documentation](../README.md)
3. Verify your Nord Pool integration is working correctly
4. Check Home Assistant logs for errors related to `battery_energy_trading`
